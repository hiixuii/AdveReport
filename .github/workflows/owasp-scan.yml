- name: Download Excel Report and Verify
  if: env.REPORT_FILE != ''
  env:
    REPORT_FILE: ${{ env.REPORT_FILE }}
  run: |
    REPORT_FILE_PATH=$(basename "${REPORT_FILE}")
    curl -fSL -o "${REPORT_FILE_PATH}" "http://34.135.194.57:28291/reports/${REPORT_FILE}"
    
    # Проверяем, что файл реально Excel
    if file "${REPORT_FILE_PATH}" | grep -qE 'Microsoft Excel|Composite Document|Spreadsheet'; then
      echo "✅ Report downloaded and verified: ${REPORT_FILE_PATH}"
      echo "REPORT_FILE_PATH=${REPORT_FILE_PATH}" >> $GITHUB_ENV
    else
      echo "❌ Downloaded file is NOT a valid Excel file"
      echo "File type:"
      file "${REPORT_FILE_PATH}"
      echo "File contents (first lines):"
      head -n 20 "${REPORT_FILE_PATH}"
      exit 1
    fi
