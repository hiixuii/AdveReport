  - name: Trigger OWASP Scan
    id: trigger
    run: |
      RESPONSE=$(curl -X POST "http://34.135.194.57:28291/start_scan" \
        -H "Content-Type: application/json" \
        -d '{
          // ... existing code ...
        }')
      echo "Response: $RESPONSE"
      # Debug the response
      echo "Full response content:"
      echo "$RESPONSE" | jq '.'
      
      SCAN_ID=$(echo "$RESPONSE" | jq -r '.id // empty')
      if [ -z "$SCAN_ID" ]; then
        echo "❌ Error: Failed to get scan ID from response"
        exit 1
      fi
      echo "✅ Got scan ID: $SCAN_ID"
      echo "SCAN_ID=$SCAN_ID" >> $GITHUB_ENV 

  - name: Download Excel Report
    if: env.REPORT_FILE != ''
    run: |
      HTTP_CODE=$(curl -w "%{http_code}" -o "${REPORT_FILE}" "http://34.135.194.57:28291/reports/${REPORT_FILE}")
      if [ "$HTTP_CODE" != "200" ]; then
        echo "❌ Failed to download report. HTTP Status: $HTTP_CODE"
        echo "Content of failed download:"
        cat "${REPORT_FILE}"
        exit 1
      fi
      
      # Verify file is actually an Excel file
      if file "${REPORT_FILE}" | grep -q "Excel"; then
        echo "✅ Report downloaded successfully: ${REPORT_FILE}"
      else
        echo "❌ Downloaded file is not an Excel file"
        echo "File type:"
        file "${REPORT_FILE}"
        exit 1
      fi
